"use strict";!function(){var e,i=ax5.ui,t=ax5.util;i.addClass({className:"mediaViewer",version:"0.4.3"},function(){var a=function(){var a,n=this,s={mousedown:ax5.info.supportTouch?"touchstart":"mousedown",mousemove:ax5.info.supportTouch?"touchmove":"mousemove",mouseup:ax5.info.supportTouch?"touchend":"mouseup"},d=function(e){var i="changedTouches"in e.originalEvent?e.originalEvent.changedTouches[0]:e;return{clientX:i.clientX,clientY:i.clientY,time:(new Date).getTime()}};this.instanceId=ax5.getGuid(),this.config={clickEventName:"click",theme:"default",animateTime:250,columnKeys:{src:"src",poster:"poster",html:"html"},loading:{icon:"",text:"Now Loading"},viewer:{prevHandle:!1,nextHandle:!1,ratio:16/9},media:{prevHandle:"<",nextHandle:">",width:36,height:36,list:[]}},this.queue=[],this.openTimer=null,this.closeTimer=null,this.selectedIndex=0,this.mousePosition={},a=this.config;var l=function(){var i=jQuery.extend(!0,{id:this.id},a);try{return e.tmpl.get.call(this,"frame",i,a.columnKeys)}finally{i=null}},h=function(e,i){var s,d="",l={thumbnail:function(e){this.select(e.getAttribute("data-media-thumbnail"))},prev:function(e){this.selectedIndex>0?this.select(this.selectedIndex-1):this.select(a.media.list.length-1)},next:function(e){this.selectedIndex<a.media.list.length-1?this.select(this.selectedIndex+1):this.select(0)},viewer:function(e){n.onClick&&n.onClick.call({media:a.media.list[this.selectedIndex]})}};if(i=t.findParentNode(e.target,function(e){return e.getAttribute("data-media-thumbnail")?(d="thumbnail",!0):"media-list-prev-handle"==e.getAttribute("data-media-viewer-els")?(d="prev",!0):"media-list-next-handle"==e.getAttribute("data-media-viewer-els")?(d="next",!0):"viewer"==e.getAttribute("data-media-viewer-els")?(d="viewer",!0):n.target.get(0)==e||void 0})){for(var h in l)if(h==d){s=l[h].call(this,i);break}return this}return this},r=function(){if(a.media&&a.media.list&&a.media.list.length>0){for(var e=a.media.list.length,i=0;e--;)if(a.media.list[e].selected){i=e;break}0==i&&(a.media.list[0].selected=!0);try{return i}finally{e=null,i=null}}},o=function(){var e=this.$.list.find("[data-media-thumbnail="+this.selectedIndex+"]"),i=e.position(),t=e.outerWidth(),a=this.$.list.outerWidth(),n=this.$["list-table"].position().left,s=this.$["list-table"].outerWidth(),d=0;i.left+t+n>a?(d=a-(i.left+t),n!=d&&this.$["list-table"].css({left:n=d})):i.left+n<0&&(d=i.left,d>0&&(d=0),n!=d&&this.$["list-table"].css({left:n=d})),n!=d&&n+s<a&&(d=a-s,d>0&&(d=0),this.$["list-table"].css({left:d})),e=null,i=null,t=null,a=null,n=null,d=null},m={on:function(e){var i=function(i){var t=i;return"changedTouches"in i.originalEvent&&(t=i.originalEvent.changedTouches[0]),e.__dx=t.clientX-e.clientX,e.__dy=t.clientY-e.clientY,e.__time=(new Date).getTime(),Math.abs(e.__dx)>Math.abs(e.__dy)?{left:e.__dx}:{top:e.__dy}},d=this.$.viewer.width();jQuery(document.body).bind(s.mousemove+".ax5media-viewer-"+this.instanceId,function(e){var s=i(e);if("left"in s){if(n.$["viewer-holder"].css(s),Math.abs(n.mousePosition.__dx)>d/3){var l=0;n.mousePosition.__dx>0?l=n.selectedIndex>0?n.selectedIndex-1:a.media.list.length-1:n.selectedIndex<a.media.list.length-1&&(l=n.selectedIndex+1),n.select(l),m.off.call(n)}t.stopEvent(e)}}).bind(s.mouseup+".ax5media-viewer-"+this.instanceId,function(e){m.off.call(n)}).bind("mouseleave.ax5media-viewer-"+this.instanceId,function(e){m.off.call(n)}),jQuery(document.body).attr("unselectable","on").css("user-select","none").on("selectstart",!1)},off:function(){n.$["viewer-holder"].css({left:0}),jQuery(document.body).unbind(s.mousemove+".ax5media-viewer-"+this.instanceId).unbind(s.mouseup+".ax5media-viewer-"+this.instanceId).unbind("mouseleave.ax5media-viewer-"+this.instanceId),jQuery(document.body).removeAttr("unselectable").css("user-select","auto").off("selectstart")}};this.init=function(){this.onStateChanged=a.onStateChanged,this.onClick=a.onClick,this.id="ax5-media-viewer-"+ax5.getGuid(),a.target&&a.media&&a.media.list&&a.media.list.length>0&&this.attach(a.target)},this.attach=function(e,i){return e||console.log(ax5.info.getError("ax5mediaViewer","401","setConfig")),"undefined"!=typeof i&&this.setConfig(i,!1),this.target=jQuery(e),this.target.html(l.call(this)),this.$={root:this.target.find("[data-ax5-ui-media-viewer]"),"viewer-holder":this.target.find('[data-media-viewer-els="viewer-holder"]'),viewer:this.target.find('[data-media-viewer-els="viewer"]'),"viewer-loading":this.target.find('[data-media-viewer-els="viewer-loading"]'),"list-holder":this.target.find('[data-media-viewer-els="media-list-holder"]'),"list-prev-handle":this.target.find('[data-media-viewer-els="media-list-prev-handle"]'),list:this.target.find('[data-media-viewer-els="media-list"]'),"list-table":this.target.find('[data-media-viewer-els="media-list-table"]'),"list-next-handle":this.target.find('[data-media-viewer-els="media-list-next-handle"]')},this.align(),jQuery(window).unbind("resize.ax5media-viewer-"+this.id).bind("resize.ax5media-viewer-"+this.id,function(){this.align(),o.call(this)}.bind(this)),this.target.unbind("click").bind("click",function(e){e=e||window.event,h.call(this,e),t.stopEvent(e)}.bind(this)),this.$.viewer.unbind(s.mousedown).bind(s.mousedown,function(e){this.mousePosition=d(e),m.on.call(this,this.mousePosition)}.bind(this)).unbind("dragstart").bind("dragstart",function(e){return t.stopEvent(e),!1}),this.select(r.call(this)),this},this.align=function(){if(this.$["viewer-holder"].css({height:this.$.viewer.width()/a.viewer.ratio}),this.$.viewer.css({height:this.$.viewer.width()/a.viewer.ratio}),"image"==this.$.viewer.data("media-type")){var e=this.$.viewer.find("img");e.css({width:this.$.viewer.height()*this.$.viewer.data("img-ratio"),height:this.$.viewer.height()}),setTimeout(function(e){e.css({left:(this.$.viewer.width()-e.width())/2})}.bind(this,e),1)}else"video"==this.$.viewer.data("media-type")&&this.$.viewer.find("iframe").css({width:this.$.viewer.height()*this.$.viewer.data("img-ratio"),height:this.$.viewer.height()});this.$["viewer-loading"].css({height:this.$.viewer.height()});var i="%"==t.right(a.media.width,1)?t.number(a.media.width)/100*this.$.viewer.width():t.number(a.media.width),n="%"==t.right(a.media.height,1)?t.number(a.media.height)/100*this.$.viewer.width():t.number(a.media.height);return i=Math.floor(i),n=Math.floor(n),this.$["list-prev-handle"].css({width:1.5*i}),this.$["list-next-handle"].css({width:1.5*i}),this.$.list.css({height:n}),this.$["list-table"].find("[data-media-thumbnail]").css({width:i,height:n}),this.$["list-table"].find("[data-media-thumbnail-video]").css({width:i,height:n}),this},this.select=function(){var e={image:function(e,i){n.$["viewer-loading"].show();var t=[this.$.viewer.width(),this.$.viewer.height()],s=new Image;return s.src=e.image[a.columnKeys.src],s.onload=function(){n.$["viewer-loading"].fadeOut();var e=t[1],a=e*s.width/s.height;i(s,Math.floor(a),e)},s},video:function(e,i){n.$["viewer-loading"].show();var t=[this.$.viewer.width(),this.$.viewer.height()],s=jQuery(e.video[a.columnKeys.html]);i(s,t[0],t[1]),n.$["viewer-loading"].fadeOut()}},i={image:function(e,i,t){e.width=i,e.height=t;var a=$(e);this.$.viewer.html(a),a.css({left:(this.$.viewer.width()-i)/2}),this.$.viewer.data("media-type","image"),this.$.viewer.data("img-ratio",i/t)},video:function(e,i,t){e.css({width:i,height:t}),this.$.viewer.html(e),this.$.viewer.data("media-type","video"),this.$.viewer.data("img-ratio",i/t)}},t=function(e){this.$.list.find("[data-media-thumbnail]").removeClass("selected"),this.$.list.find("[data-media-thumbnail="+e+"]").addClass("selected"),o.call(this)};return function(n){if("undefined"==typeof n)return this;this.selectedIndex=Number(n);var s=a.media.list[n];t.call(this,n);for(var d in e)if(s[d]){e[d].call(this,s,i[d].bind(this));break}return this}}(),this.setMediaList=function(e){return a.media.list=[].concat(e),this.attach(a.target),this},this.main=function(){i.mediaViewer_instance=i.mediaViewer_instance||[],i.mediaViewer_instance.push(this),arguments&&t.isObject(arguments[0])?this.setConfig(arguments[0]):this.init()}.apply(this,arguments)};return a}()),e=ax5.ui.mediaViewer}(),function(){var e=ax5.ui.mediaViewer,i=function(e){return'\n            <div data-ax5-ui-media-viewer="{{id}}" class="{{theme}}">\n                <div data-media-viewer-els="viewer-holder">\n                <div data-media-viewer-els="viewer"></div>\n                </div>\n                <div data-media-viewer-els="viewer-loading">\n                <div class="ax5-ui-media-viewer-loading-holder">\n                <div class="ax5-ui-media-viewer-loading-cell">\n                {{{loading.icon}}}\n            {{{loading.text}}}\n            </div>\n            </div>\n            </div>\n            {{#media}}\n            <div data-media-viewer-els="media-list-holder">\n                <div data-media-viewer-els="media-list-prev-handle">{{{prevHandle}}}</div>\n            <div data-media-viewer-els="media-list">\n                <div data-media-viewer-els="media-list-table">\n                {{#list}}\n            <div data-media-viewer-els="media-list-table-td">\n                {{#image}}\n            <div data-media-thumbnail="{{@i}}">\n                <img src="{{'+e.poster+'}}" data-media-thumbnail-image="{{@i}}" />\n                </div>\n                {{/image}}\n            {{#video}}\n            <div data-media-thumbnail="{{@i}}">{{#'+e.poster+'}}<img src="{{.}}" data-media-thumbnail-video="{{@i}}" />>{{/'+e.poster+"}}{{^"+e.poster+'}}<a data-media-thumbnail-video="{{@i}}">{{{media.'+e.poster+"}}}</a>{{/"+e.poster+'}}</div>\n            {{/video}}\n            </div>\n                {{/list}}\n            </div>\n                </div>\n                <div data-media-viewer-els="media-list-next-handle">{{{nextHandle}}}</div>\n                </div>\n                {{/media}}\n            </div>\n        '};e.tmpl={frame:i,get:function(i,t,a){return ax5.mustache.render(e.tmpl[i].call(this,a),t)}}}();